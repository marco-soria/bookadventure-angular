<div class="space-y-6">
  <div class="flex justify-between items-center">
    <h2 class="text-2xl font-semibold text-base-content">Books Management</h2>
    <button class="btn btn-primary" (click)="openForm()">
      <svg
        class="w-4 h-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 4v16m8-8H4"
        ></path>
      </svg>
      Add Book
    </button>
  </div>

  <!-- Loading Spinner -->
  @if (isLoading()) {
  <div class="flex justify-center py-8">
    <span class="loading loading-spinner loading-lg"></span>
  </div>
  }

  <!-- Books Table -->
  @if (!isLoading()) {
  <div class="space-y-4">
    <!-- Page Size and Info -->
    <div class="flex justify-between items-center">
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2">
          <span class="text-sm text-base-content">Show:</span>
          <select
            class="select select-bordered select-sm"
            [value]="pageSize()"
            (change)="changePageSize(+$any($event).target.value)"
          >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
          </select>
          <span class="text-sm text-base-content">per page</span>
        </div>
      </div>
      <div class="text-sm text-base-content">
        Showing {{ (currentPage() - 1) * pageSize() + 1 }} to
        {{ Math.min(currentPage() * pageSize(), totalItems()) }} of
        {{ totalItems() }} books
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="table table-zebra bg-base-100">
        <thead>
          <tr>
            <th>ID</th>
            <th>Title</th>
            <th>Author</th>
            <th>Genre</th>
            <th>ISBN</th>
            <th>Stock</th>
            <th>Available</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (book of paginatedBooks(); track book.id) {
          <tr [class]="!book.status ? 'opacity-60' : ''">
            <td>{{ book.id }}</td>
            <td>{{ book.title }}</td>
            <td>{{ book.author }}</td>
            <td>{{ book.genreName }}</td>
            <td>{{ book.isbn }}</td>
            <td>{{ book.stock }}</td>
            <td>
              <div
                class="badge"
                [class]="book.isAvailable ? 'badge-success' : 'badge-error'"
              >
                {{ book.isAvailable ? "Yes" : "No" }}
              </div>
            </td>
            <td>
              <div
                class="badge"
                [class]="book.status ? 'badge-success' : 'badge-error'"
              >
                {{ book.status ? "Active" : "Deleted" }}
              </div>
            </td>
            <td>
              <div class="flex gap-2">
                <button
                  class="btn btn-sm btn-info"
                  (click)="openForm(book)"
                  [disabled]="!book.status"
                >
                  Edit
                </button>
                <button
                  class="btn btn-sm btn-error"
                  (click)="delete(book.id)"
                  [disabled]="!book.status"
                >
                  Delete
                </button>
                <button
                  class="btn btn-sm btn-success"
                  (click)="restore(book.id)"
                  [disabled]="book.status"
                >
                  Restore
                </button>
              </div>
            </td>
          </tr>
          } @empty {
          <tr>
            <td colspan="9" class="text-center">No books found</td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Pagination Controls -->
    @if (totalPages() > 1) {
    <div class="flex justify-center">
      <div class="join">
        <button
          class="join-item btn"
          [disabled]="currentPage() === 1"
          (click)="prevPage()"
        >
          «
        </button>

        @for (page of visiblePages(); track page) {
        <button
          class="join-item btn"
          [class.btn-active]="currentPage() === page"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
        }

        <button
          class="join-item btn"
          [disabled]="currentPage() === totalPages()"
          (click)="nextPage()"
        >
          »
        </button>
      </div>
    </div>
    }
  </div>
  }

  <!-- Book Form Modal -->
  @if (showForm()) {
  <dialog class="modal modal-open">
    <div class="modal-box bg-base-100 max-w-2xl">
      <h3 class="font-bold text-xl mb-6 text-base-content">
        {{ editingItem() ? "Edit Book" : "Add New Book" }}
      </h3>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Title -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">Title *</span>
          </label>
          <input
            type="text"
            placeholder="Enter book title"
            class="input input-bordered w-full focus:input-primary"
            [(ngModel)]="form().title"
          />
        </div>

        <!-- Author -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">Author *</span>
          </label>
          <input
            type="text"
            placeholder="Enter author name"
            class="input input-bordered w-full focus:input-primary"
            [(ngModel)]="form().author"
          />
        </div>

        <!-- ISBN -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">ISBN *</span>
          </label>
          <input
            type="text"
            placeholder="Enter ISBN"
            class="input input-bordered w-full focus:input-primary"
            [(ngModel)]="form().isbn"
          />
        </div>

        <!-- Genre -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">Genre *</span>
          </label>
          <select
            class="select select-bordered w-full focus:select-primary"
            [(ngModel)]="form().genreId"
          >
            <option value="0" disabled>Select a genre</option>
            @for (genre of genres(); track genre.id) {
            <option [value]="genre.id">{{ genre.name }}</option>
            }
          </select>
        </div>

        <!-- Stock -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">Stock *</span>
          </label>
          <input
            type="number"
            min="0"
            max="999"
            placeholder="Enter stock quantity"
            class="input input-bordered w-full focus:input-primary"
            [(ngModel)]="form().stock"
          />
        </div>

        <!-- Image URL -->
        <div class="form-control w-full">
          <label class="label">
            <span class="label-text font-medium">Image URL</span>
          </label>
          <input
            type="url"
            placeholder="Enter image URL"
            class="input input-bordered w-full focus:input-primary"
            [(ngModel)]="form().imageUrl"
          />
        </div>

        <!-- Description - Full width -->
        <div class="form-control w-full md:col-span-2">
          <label class="label">
            <span class="label-text font-medium">Description</span>
          </label>
          <textarea
            class="textarea textarea-bordered w-full h-24 focus:textarea-primary resize-none"
            placeholder="Enter book description"
            [(ngModel)]="form().description"
          ></textarea>
        </div>

        <!-- Available checkbox - Full width -->
        <div class="form-control w-full md:col-span-2">
          <label class="label cursor-pointer justify-start gap-3">
            <input
              type="checkbox"
              class="checkbox checkbox-primary"
              [(ngModel)]="form().isAvailable"
            />
            <span class="label-text font-medium"
              >Book is available for rental</span
            >
          </label>
        </div>
      </div>

      <div class="modal-action mt-8">
        <button class="btn btn-ghost" (click)="closeForm()">Cancel</button>
        <button
          class="btn btn-primary"
          (click)="save()"
          [disabled]="isLoading()"
        >
          @if (isLoading()) {
          <span class="loading loading-spinner loading-sm"></span>
          }
          {{ editingItem() ? "Update Book" : "Create Book" }}
        </button>
      </div>
    </div>
    <form method="dialog" class="modal-backdrop">
      <button (click)="closeForm()">close</button>
    </form>
  </dialog>
  }
</div>
